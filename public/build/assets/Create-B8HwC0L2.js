import{u as M,s as E,A as L,B as S,c as i,o as n,a as s,f as m,g as p,k as V,e as o,F as x,r as v,t as a,v as b,m as h,d as g,z,C as $,b as B,w as R,l as j,h as D}from"./app-DbnE9Vpg.js";const F={class:"p-6 max-w-7xl mx-auto space-y-8 text-admin-text"},I={class:"space-y-4"},O={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},P=["value"],T={key:0,class:"text-red-500 text-sm mt-1"},K=["value"],q={key:0,class:"text-red-500 text-sm mt-1"},G={key:0,class:"text-red-500 text-sm mt-1"},H={key:0,class:"text-red-500 text-sm mt-1"},J={key:0,class:"text-red-500 text-sm mt-1"},Q={class:"flex items-center gap-2"},W={class:"space-y-4"},X={class:"grid grid-cols-1 md:grid-cols-3 gap-6"},Y={class:"font-semibold uppercase"},Z=["onUpdate:modelValue"],ee={key:0,class:"text-red-500 text-sm mt-1"},se=["onUpdate:modelValue"],te={key:0,class:"text-red-500 text-sm mt-1"},le=["onUpdate:modelValue"],oe=["onUpdate:modelValue"],re={class:"space-y-4"},ie={class:"space-y-2"},ne={key:0,class:"text-red-500 text-sm mt-1"},de={key:0,class:"grid grid-cols-2 md:grid-cols-4 gap-4 mt-4"},ae=["src","alt"],ue={class:"p-2 space-y-1 text-xs"},me={class:"truncate font-medium"},pe={class:"flex flex-col gap-1 mt-1"},be={class:"inline-flex items-center gap-1"},ce=["value"],_e={class:"inline-flex items-center gap-1"},xe=["value"],ve={class:"space-y-1"},fe={key:0,class:"text-red-500 text-sm"},ye={key:1,class:"text-red-500 text-sm"},ge={class:"space-y-4"},ke={class:"block font-semibold mb-2"},we={class:"flex flex-wrap gap-3"},Ue=["for"],Ve=["id","value","onUpdate:modelValue"],he={key:0,class:"text-red-500 text-sm mt-2"},$e={class:"flex gap-2"},Ne={__name:"Create",props:{brands:{type:Array,default:()=>[]},categories:{type:Array,default:()=>[]},attributes:{type:Array,default:()=>[]}},setup(A){const _=A,t=M({brand_id:null,category_id:null,sku:"",price:0,currency:"MDL",is_active:!0,sort_order:0,translations:{ru:{name:"",slug:"",short_description:"",full_description:""},ro:{name:"",slug:"",short_description:"",full_description:""},en:{name:"",slug:"",short_description:"",full_description:""}},images:[],main_image_index:null,small_image_index:null,attributes:{}}),f=E([]),w=()=>{f.value.forEach(u=>{u.url&&URL.revokeObjectURL(u.url)}),f.value=[]},N=u=>{const e=Array.from(u.target.files||[]);w(),t.images=e,t.main_image_index=null,t.small_image_index=null,f.value=e.map(l=>({url:URL.createObjectURL(l),name:l.name,size:l.size}))};L(()=>{w()}),S(()=>{_.attributes.forEach(u=>{Array.isArray(t.attributes[u.id])||(t.attributes[u.id]=[])})}),t.transform(u=>{const e={};_.attributes.forEach(r=>{e[r.id]=new Set((r.values||[]).map(d=>Number(d.id)))});const l={};return Object.keys(e).forEach(r=>{var U;const d=Number(r),c=(U=u.attributes)==null?void 0:U[d],k=Array.isArray(c)?c:c!=null?[c]:[];l[d]=k.map(y=>Number(y)).filter(y=>Number.isInteger(y)&&e[d].has(y))}),{...u,attributes:l}});const C=()=>{_.attributes.forEach(u=>{Array.isArray(t.attributes[u.id])||(t.attributes[u.id]=[])}),t.post(route("admin.products.store"))};return(u,e)=>(n(),i("div",F,[e[32]||(e[32]=s("h1",{class:"text-xl font-semibold"},"Добавить товар",-1)),s("form",{onSubmit:D(C,["prevent"]),class:"space-y-8"},[s("div",I,[e[18]||(e[18]=s("h2",{class:"text-lg font-semibold"},"Основные данные",-1)),s("div",O,[s("div",null,[e[10]||(e[10]=s("label",{class:"block font-semibold mb-1"},"Бренд",-1)),m(s("select",{"onUpdate:modelValue":e[0]||(e[0]=l=>o(t).brand_id=l),class:"w-full rounded border px-2 py-1 bg-white"},[e[9]||(e[9]=s("option",{value:null},"— не выбран —",-1)),(n(!0),i(x,null,v(_.brands,l=>{var r;return n(),i("option",{key:l.id,value:l.id},a(((r=l.translation)==null?void 0:r.name)??`#${l.id}`),9,P)}),128))],512),[[V,o(t).brand_id]]),o(t).errors.brand_id?(n(),i("div",T,a(o(t).errors.brand_id),1)):p("",!0)]),s("div",null,[e[12]||(e[12]=s("label",{class:"block font-semibold mb-1"},"Категория",-1)),m(s("select",{"onUpdate:modelValue":e[1]||(e[1]=l=>o(t).category_id=l),class:"w-full rounded border px-2 py-1 bg-white"},[e[11]||(e[11]=s("option",{value:null},"— не выбрана —",-1)),(n(!0),i(x,null,v(_.categories,l=>{var r;return n(),i("option",{key:l.id,value:l.id},a(((r=l.translation)==null?void 0:r.name)??`#${l.id}`),9,K)}),128))],512),[[V,o(t).category_id]]),o(t).errors.category_id?(n(),i("div",q,a(o(t).errors.category_id),1)):p("",!0)]),s("div",null,[e[13]||(e[13]=s("label",{class:"block font-semibold mb-1"},"SKU",-1)),m(s("input",{"onUpdate:modelValue":e[2]||(e[2]=l=>o(t).sku=l),class:"w-full rounded border px-2 py-1"},null,512),[[b,o(t).sku]]),o(t).errors.sku?(n(),i("div",G,a(o(t).errors.sku),1)):p("",!0)]),s("div",null,[e[14]||(e[14]=s("label",{class:"block font-semibold mb-1"},"Цена",-1)),m(s("input",{type:"number",step:"0.01","onUpdate:modelValue":e[3]||(e[3]=l=>o(t).price=l),class:"w-full rounded border px-2 py-1"},null,512),[[b,o(t).price,void 0,{number:!0}]]),o(t).errors.price?(n(),i("div",H,a(o(t).errors.price),1)):p("",!0)]),s("div",null,[e[15]||(e[15]=s("label",{class:"block font-semibold mb-1"},"Валюта",-1)),m(s("input",{"onUpdate:modelValue":e[4]||(e[4]=l=>o(t).currency=l),class:"w-full rounded border px-2 py-1"},null,512),[[b,o(t).currency]]),o(t).errors.currency?(n(),i("div",J,a(o(t).errors.currency),1)):p("",!0)]),s("div",Q,[m(s("input",{id:"is_active",type:"checkbox","onUpdate:modelValue":e[5]||(e[5]=l=>o(t).is_active=l)},null,512),[[h,o(t).is_active]]),e[16]||(e[16]=s("label",{for:"is_active",class:"font-semibold"},"Активен",-1))]),s("div",null,[e[17]||(e[17]=s("label",{class:"block font-semibold mb-1"},"Порядок",-1)),m(s("input",{type:"number",min:"0","onUpdate:modelValue":e[6]||(e[6]=l=>o(t).sort_order=l),class:"w-full rounded border px-2 py-1"},null,512),[[b,o(t).sort_order,void 0,{number:!0}]])])])]),s("div",W,[e[23]||(e[23]=s("h2",{class:"text-lg font-semibold"},"Переводы",-1)),s("div",X,[(n(),i(x,null,v(["ru","ro","en"],l=>s("div",{key:l,class:"space-y-2"},[s("h3",Y,a(l),1),s("div",null,[e[19]||(e[19]=s("label",{class:"block"},"Название",-1)),m(s("input",{"onUpdate:modelValue":r=>o(t).translations[l].name=r,class:"w-full rounded border px-2 py-1"},null,8,Z),[[b,o(t).translations[l].name]]),o(t).errors[`translations.${l}.name`]?(n(),i("div",ee,a(o(t).errors[`translations.${l}.name`]),1)):p("",!0)]),s("div",null,[e[20]||(e[20]=s("label",{class:"block"},"Slug",-1)),m(s("input",{"onUpdate:modelValue":r=>o(t).translations[l].slug=r,class:"w-full rounded border px-2 py-1"},null,8,se),[[b,o(t).translations[l].slug]]),o(t).errors[`translations.${l}.slug`]?(n(),i("div",te,a(o(t).errors[`translations.${l}.slug`]),1)):p("",!0)]),s("div",null,[e[21]||(e[21]=s("label",{class:"block"},"Кратко",-1)),m(s("textarea",{"onUpdate:modelValue":r=>o(t).translations[l].short_description=r,class:"w-full rounded border px-2 py-1",rows:"3"},null,8,le),[[b,o(t).translations[l].short_description]])]),s("div",null,[e[22]||(e[22]=s("label",{class:"block"},"Полное описание",-1)),m(s("textarea",{"onUpdate:modelValue":r=>o(t).translations[l].full_description=r,class:"w-full rounded border px-2 py-1",rows:"5"},null,8,oe),[[b,o(t).translations[l].full_description]])])])),64))])]),s("div",re,[e[28]||(e[28]=s("h2",{class:"text-lg font-semibold"},"Галерея",-1)),s("div",ie,[e[24]||(e[24]=s("label",{class:"block font-semibold"},"Фотографии товара",-1)),s("input",{type:"file",multiple:"",onChange:N},null,32),e[25]||(e[25]=s("p",{class:"text-sm text-gray-500"},[g(" Загрузите все нужные фотографии, затем ниже выберите одну "),s("span",{class:"font-semibold"},"основную"),g(" и одну "),s("span",{class:"font-semibold"},"для сетки"),g(" . ")],-1)),o(t).errors["images.0"]?(n(),i("div",ne,"Проверьте форматы и размер файлов")):p("",!0)]),f.value.length?(n(),i("div",de,[(n(!0),i(x,null,v(f.value,(l,r)=>(n(),i("div",{key:r,class:z(["relative rounded-lg overflow-hidden border bg-white shadow-sm",[o(t).main_image_index===r?"border-green-500 ring-2 ring-green-400":"",o(t).small_image_index===r?"border-blue-500 ring-2 ring-blue-400":""]])},[s("img",{src:l.url,alt:l.name,class:"w-full h-40 object-cover"},null,8,ae),s("div",ue,[s("div",me,a(l.name),1),s("div",pe,[s("label",be,[m(s("input",{type:"radio",name:"main_image",value:r,"onUpdate:modelValue":e[7]||(e[7]=d=>o(t).main_image_index=d)},null,8,ce),[[$,o(t).main_image_index]]),e[26]||(e[26]=s("span",{class:"text-green-700 font-semibold"},"Основное",-1))]),s("label",_e,[m(s("input",{type:"radio",name:"small_image",value:r,"onUpdate:modelValue":e[8]||(e[8]=d=>o(t).small_image_index=d)},null,8,xe),[[$,o(t).small_image_index]]),e[27]||(e[27]=s("span",{class:"text-blue-700 font-semibold"},"Для сетки (small)",-1))])])])],2))),128))])):p("",!0),s("div",ve,[o(t).errors.main_image_index?(n(),i("div",fe,a(o(t).errors.main_image_index),1)):p("",!0),o(t).errors.small_image_index?(n(),i("div",ye,a(o(t).errors.small_image_index),1)):p("",!0)])]),s("div",ge,[e[29]||(e[29]=s("h2",{class:"text-lg font-semibold"},"Атрибуты",-1)),(n(!0),i(x,null,v(_.attributes,l=>{var r;return n(),i("div",{key:l.id,class:"rounded border p-4 bg-white/50"},[s("label",ke,a(((r=l.translation)==null?void 0:r.name)??`#${l.id}`),1),s("div",we,[(n(!0),i(x,null,v(l.values||[],d=>{var c;return n(),i("label",{key:d.id,class:"inline-flex items-center gap-2 text-sm px-2 py-1 rounded hover:bg-admin-muted/10 transition",for:`attr-${l.id}-val-${d.id}`},[m(s("input",{class:"rounded",type:"checkbox",id:`attr-${l.id}-val-${d.id}`,value:d.id,"onUpdate:modelValue":k=>o(t).attributes[l.id]=k},null,8,Ve),[[h,o(t).attributes[l.id]]]),s("span",null,a(((c=d.translation)==null?void 0:c.value)??`#${d.id}`),1)],8,Ue)}),128))]),o(t).errors[`attributes.${l.id}`]?(n(),i("div",he,a(o(t).errors[`attributes.${l.id}`]),1)):p("",!0)])}),128))]),s("div",$e,[e[31]||(e[31]=s("button",{class:"bg-admin-primary text-white px-4 py-2 rounded-lg hover:bg-admin-muted transition"}," Сохранить ",-1)),B(o(j),{href:u.route("admin.products.index"),class:"px-4 py-2 border rounded-lg hover:bg-white transition"},{default:R(()=>e[30]||(e[30]=[g(" Отмена ",-1)])),_:1,__:[30]},8,["href"])])],32)]))}};export{Ne as default};
