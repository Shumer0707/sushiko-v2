import{u as E,q as S,i as D,c as m,o as b,a as t,f as u,k as N,e as o,F as _,r as g,t as y,v as f,m as k,s as F,b as j,w as B,d as C,l as L,h as T}from"./app-B0rAfYly.js";const q={class:"max-w-7xl mx-auto py-6 space-y-8 text-admin-text"},O={class:"space-y-4"},z={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},K=["value"],P=["value"],R={class:"flex items-center gap-2"},G={class:"space-y-4"},H={class:"grid grid-cols-1 md:grid-cols-3 gap-6"},J={class:"font-semibold uppercase"},Q=["onUpdate:modelValue"],W=["onUpdate:modelValue"],X=["onUpdate:modelValue"],Y=["onUpdate:modelValue"],Z={class:"space-y-4"},ee={class:"grid grid-cols-2 md:grid-cols-6 gap-4"},te=["src"],se={class:"mt-2 flex items-center justify-between text-sm"},le={class:"flex items-center gap-1"},ie=["value"],re={class:"flex items-center gap-1"},oe=["value"],de={class:"space-y-4"},ne={class:"block font-semibold mb-2"},ae={class:"flex flex-wrap gap-3"},ue=["for"],pe=["id","value","onUpdate:modelValue"],me={class:"flex gap-2"},ce={__name:"Edit",props:{product:{type:Object,required:!0},brands:{type:Array,default:()=>[]},categories:{type:Array,default:()=>[]},attributes:{type:Array,default:()=>[]}},setup(h){var V,U;const n=h,p=(i,e)=>{var s,r;return((r=(s=n.product.translations)==null?void 0:s.find(a=>a.language===i))==null?void 0:r[e])??""},l=E({brand_id:n.product.brand_id??null,category_id:n.product.category_id??null,sku:n.product.sku??"",price:n.product.price??0,currency:n.product.currency??"MDL",is_active:!!n.product.is_active,sort_order:n.product.sort_order??0,translations:{ru:{name:p("ru","name"),slug:p("ru","slug"),short_description:p("ru","short_description"),full_description:p("ru","full_description")},ro:{name:p("ro","name"),slug:p("ro","slug"),short_description:p("ro","short_description"),full_description:p("ro","full_description")},en:{name:p("en","name"),slug:p("en","slug"),short_description:p("en","short_description"),full_description:p("en","full_description")}},images:[],delete_image_ids:[],main_image_id:((U=(V=n.product.images)==null?void 0:V.find(i=>i.is_main))==null?void 0:U.id)??null,attributes:{}}),w=()=>{n.attributes.forEach(i=>{Array.isArray(l.attributes[i.id])||(l.attributes[i.id]=[])}),(n.product.attribute_values||[]).forEach(i=>{var r;const e=(r=i==null?void 0:i.pivot)==null?void 0:r.attribute_id,s=i==null?void 0:i.id;!e||!Number.isInteger(Number(e))||!Number.isInteger(Number(s))||(Array.isArray(l.attributes[e])||(l.attributes[e]=[]),l.attributes[e].includes(s)||l.attributes[e].push(s))})};S(()=>{w()}),D(()=>n.product,i=>{var e,s,r;l.brand_id=i.brand_id??null,l.category_id=i.category_id??null,l.sku=i.sku??"",l.price=i.price??0,l.currency=i.currency??"MDL",l.is_active=!!i.is_active,l.sort_order=i.sort_order??0;for(const a of["ru","ro","en"]){const d=(e=i.translations)==null?void 0:e.find(c=>c.language===a);l.translations[a].name=(d==null?void 0:d.name)??"",l.translations[a].slug=(d==null?void 0:d.slug)??"",l.translations[a].short_description=(d==null?void 0:d.short_description)??"",l.translations[a].full_description=(d==null?void 0:d.full_description)??""}l.main_image_id=((r=(s=i.images)==null?void 0:s.find(a=>a.is_main))==null?void 0:r.id)??null,l.attributes={},w()},{immediate:!1});const I=i=>{l.images=Array.from(i.target.files||[])};l.transform(i=>{const e={};n.attributes.forEach(d=>{e[d.id]=new Set((d.values||[]).map(c=>Number(c.id)))});const s={};Object.keys(e).forEach(d=>{var A;const c=Number(d),v=(A=i.attributes)==null?void 0:A[c],$=Array.isArray(v)?v:v!=null?[v]:[];s[c]=$.map(x=>Number(x)).filter(x=>Number.isInteger(x)&&e[c].has(x))});const r=Array.isArray(i.delete_image_ids)?i.delete_image_ids.map(d=>Number(d)).filter(Number.isInteger):[],a=i.main_image_id!=null&&i.main_image_id!==""?Number(i.main_image_id):null;return{...i,_method:"put",attributes:s,delete_image_ids:r,main_image_id:a}});const M=()=>{n.attributes.forEach(i=>{Array.isArray(l.attributes[i.id])||(l.attributes[i.id]=[])}),l.post(route("admin.products.update",n.product.id),{forceFormData:!0,preserveScroll:!0})};return(i,e)=>(b(),m("div",q,[e[31]||(e[31]=t("h1",{class:"text-xl font-semibold"},"Редактировать товар",-1)),t("form",{onSubmit:T(M,["prevent"]),class:"space-y-8"},[t("div",O,[e[18]||(e[18]=t("h2",{class:"text-lg font-semibold"},"Основные данные",-1)),t("div",z,[t("div",null,[e[10]||(e[10]=t("label",{class:"block font-semibold mb-1"},"Бренд",-1)),u(t("select",{"onUpdate:modelValue":e[0]||(e[0]=s=>o(l).brand_id=s),class:"w-full rounded border px-2 py-1 bg-white"},[e[9]||(e[9]=t("option",{value:null},"— не выбран —",-1)),(b(!0),m(_,null,g(n.brands,s=>{var r;return b(),m("option",{key:s.id,value:s.id},y(((r=s.translation)==null?void 0:r.name)??`#${s.id}`),9,K)}),128))],512),[[N,o(l).brand_id]])]),t("div",null,[e[12]||(e[12]=t("label",{class:"block font-semibold mb-1"},"Категория",-1)),u(t("select",{"onUpdate:modelValue":e[1]||(e[1]=s=>o(l).category_id=s),class:"w-full rounded border px-2 py-1 bg-white"},[e[11]||(e[11]=t("option",{value:null},"— не выбрана —",-1)),(b(!0),m(_,null,g(n.categories,s=>{var r;return b(),m("option",{key:s.id,value:s.id},y(((r=s.translation)==null?void 0:r.name)??`#${s.id}`),9,P)}),128))],512),[[N,o(l).category_id]])]),t("div",null,[e[13]||(e[13]=t("label",{class:"block font-semibold mb-1"},"SKU",-1)),u(t("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>o(l).sku=s),class:"w-full rounded border px-2 py-1"},null,512),[[f,o(l).sku]])]),t("div",null,[e[14]||(e[14]=t("label",{class:"block font-semibold mb-1"},"Цена",-1)),u(t("input",{type:"number",step:"0.01","onUpdate:modelValue":e[3]||(e[3]=s=>o(l).price=s),class:"w-full rounded border px-2 py-1"},null,512),[[f,o(l).price,void 0,{number:!0}]])]),t("div",null,[e[15]||(e[15]=t("label",{class:"block font-semibold mb-1"},"Валюта",-1)),u(t("input",{"onUpdate:modelValue":e[4]||(e[4]=s=>o(l).currency=s),class:"w-full rounded border px-2 py-1"},null,512),[[f,o(l).currency]])]),t("div",R,[u(t("input",{id:"is_active",type:"checkbox","onUpdate:modelValue":e[5]||(e[5]=s=>o(l).is_active=s)},null,512),[[k,o(l).is_active]]),e[16]||(e[16]=t("label",{for:"is_active",class:"font-semibold"},"Активен",-1))]),t("div",null,[e[17]||(e[17]=t("label",{class:"block font-semibold mb-1"},"Порядок",-1)),u(t("input",{type:"number",min:"0","onUpdate:modelValue":e[6]||(e[6]=s=>o(l).sort_order=s),class:"w-full rounded border px-2 py-1"},null,512),[[f,o(l).sort_order,void 0,{number:!0}]])])])]),t("div",G,[e[23]||(e[23]=t("h2",{class:"text-lg font-semibold"},"Переводы",-1)),t("div",H,[(b(),m(_,null,g(["ru","ro","en"],s=>t("div",{key:s,class:"space-y-2"},[t("h3",J,y(s),1),t("div",null,[e[19]||(e[19]=t("label",{class:"block"},"Название",-1)),u(t("input",{"onUpdate:modelValue":r=>o(l).translations[s].name=r,class:"w-full rounded border px-2 py-1"},null,8,Q),[[f,o(l).translations[s].name]])]),t("div",null,[e[20]||(e[20]=t("label",{class:"block"},"Slug",-1)),u(t("input",{"onUpdate:modelValue":r=>o(l).translations[s].slug=r,class:"w-full rounded border px-2 py-1"},null,8,W),[[f,o(l).translations[s].slug]])]),t("div",null,[e[21]||(e[21]=t("label",{class:"block"},"Кратко",-1)),u(t("textarea",{"onUpdate:modelValue":r=>o(l).translations[s].short_description=r,class:"w-full rounded border px-2 py-1",rows:"3"},null,8,X),[[f,o(l).translations[s].short_description]])]),t("div",null,[e[22]||(e[22]=t("label",{class:"block"},"Полное описание",-1)),u(t("textarea",{"onUpdate:modelValue":r=>o(l).translations[s].full_description=r,class:"w-full rounded border px-2 py-1",rows:"5"},null,8,Y),[[f,o(l).translations[s].full_description]])])])),64))])]),t("div",Z,[e[27]||(e[27]=t("h2",{class:"text-lg font-semibold"},"Галерея",-1)),t("div",ee,[(b(!0),m(_,null,g(n.product.images||[],s=>(b(),m("div",{key:s.id,class:"border rounded p-2"},[t("img",{src:`/storage/${s.path}`,class:"w-full h-24 object-cover rounded border"},null,8,te),t("div",se,[t("label",le,[u(t("input",{type:"checkbox",value:s.id,"onUpdate:modelValue":e[7]||(e[7]=r=>o(l).delete_image_ids=r)},null,8,ie),[[k,o(l).delete_image_ids]]),e[24]||(e[24]=t("span",null,"Удалить",-1))]),t("label",re,[u(t("input",{type:"radio",name:"main",value:s.id,"onUpdate:modelValue":e[8]||(e[8]=r=>o(l).main_image_id=r)},null,8,oe),[[F,o(l).main_image_id]]),e[25]||(e[25]=t("span",null,"Главное",-1))])])]))),128))]),t("div",null,[e[26]||(e[26]=t("label",{class:"block font-semibold mb-1"},"Добавить изображения",-1)),t("input",{type:"file",multiple:"",onChange:I},null,32)])]),t("div",de,[e[28]||(e[28]=t("h2",{class:"text-lg font-semibold"},"Атрибуты",-1)),(b(!0),m(_,null,g(n.attributes,s=>{var r;return b(),m("div",{key:s.id,class:"rounded border p-4 bg-white/50"},[t("label",ne,y(((r=s.translation)==null?void 0:r.name)??`#${s.id}`),1),t("div",ae,[(b(!0),m(_,null,g(s.values||[],a=>{var d;return b(),m("label",{key:a.id,class:"flex items-center gap-2 text-sm px-2 py-1 rounded hover:bg-admin-muted/10 transition",for:`attr-${s.id}-val-${a.id}`},[u(t("input",{class:"rounded",type:"checkbox",id:`attr-${s.id}-val-${a.id}`,value:a.id,"onUpdate:modelValue":c=>o(l).attributes[s.id]=c},null,8,pe),[[k,o(l).attributes[s.id]]]),t("span",null,y(((d=a.translation)==null?void 0:d.value)??`#${a.id}`),1)],8,ue)}),128))])])}),128))]),t("div",me,[e[30]||(e[30]=t("button",{class:"bg-admin-primary text-white px-4 py-2 rounded-lg hover:bg-admin-muted transition"},"Обновить",-1)),j(o(L),{href:i.route("admin.products.index"),class:"px-4 py-2 border rounded-lg hover:bg-white transition"},{default:B(()=>e[29]||(e[29]=[C(" Отмена ",-1)])),_:1,__:[29]},8,["href"])])],32)]))}};export{ce as default};
