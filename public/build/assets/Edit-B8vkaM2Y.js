import{u as z,B,i as F,c as u,o as m,a as s,f as p,k as M,e as r,F as y,r as x,t as v,v as _,m as w,z as L,g as j,C as S,b as T,w as K,d as O,l as q,h as P}from"./app-BK6yevhJ.js";const R={class:"max-w-7xl mx-auto py-6 space-y-8 text-admin-text"},G={class:"space-y-4"},H={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},J=["value"],Q=["value"],W={class:"flex items-center gap-2"},X={class:"space-y-4"},Y={class:"grid grid-cols-1 md:grid-cols-3 gap-6"},Z={class:"font-semibold uppercase"},ee=["onUpdate:modelValue"],se=["onUpdate:modelValue"],te=["onUpdate:modelValue"],le=["onUpdate:modelValue"],ie={class:"space-y-4"},oe={class:"grid grid-cols-2 md:grid-cols-6 gap-4"},re=["src"],ne={class:"flex items-center justify-between text-[11px] text-admin-text/70"},de={key:0},ae={key:1},ue={key:2,class:"text-blue-700 font-semibold"},me={key:3,class:"text-green-700 font-semibold"},pe={class:"mt-2 flex flex-col gap-1 text-xs"},be={class:"inline-flex items-center gap-1"},ce=["value"],_e={class:"inline-flex items-center gap-1"},fe=["value"],ge={class:"inline-flex items-center gap-1"},ye=["value"],xe={class:"space-y-4"},ve={class:"block font-semibold mb-2"},ke={class:"flex flex-wrap gap-3"},we=["for"],Ve=["id","value","onUpdate:modelValue"],Ue={class:"flex gap-2"},Ae={__name:"Edit",props:{product:{type:Object,required:!0},brands:{type:Array,default:()=>[]},categories:{type:Array,default:()=>[]},attributes:{type:Array,default:()=>[]}},setup($){var U,h,A,N;const n=$,c=(i,e)=>{var t,o;return((o=(t=n.product.translations)==null?void 0:t.find(b=>b.language===i))==null?void 0:o[e])??""},l=z({brand_id:n.product.brand_id??null,category_id:n.product.category_id??null,sku:n.product.sku??"",price:n.product.price??0,currency:n.product.currency??"MDL",is_active:!!n.product.is_active,sort_order:n.product.sort_order??0,translations:{ru:{name:c("ru","name"),slug:c("ru","slug"),short_description:c("ru","short_description"),full_description:c("ru","full_description")},ro:{name:c("ro","name"),slug:c("ro","slug"),short_description:c("ro","short_description"),full_description:c("ro","full_description")},en:{name:c("en","name"),slug:c("en","slug"),short_description:c("en","short_description"),full_description:c("en","full_description")}},images:[],delete_image_ids:[],main_image_id:((h=(U=n.product.images)==null?void 0:U.find(i=>i.is_main))==null?void 0:h.id)??null,small_image_id:((N=(A=n.product.images)==null?void 0:A.find(i=>i.small_path))==null?void 0:N.id)??null,attributes:{}}),V=()=>{n.attributes.forEach(i=>{Array.isArray(l.attributes[i.id])||(l.attributes[i.id]=[])}),(n.product.attribute_values||[]).forEach(i=>{var o;const e=(o=i==null?void 0:i.pivot)==null?void 0:o.attribute_id,t=i==null?void 0:i.id;!e||!Number.isInteger(Number(e))||!Number.isInteger(Number(t))||(Array.isArray(l.attributes[e])||(l.attributes[e]=[]),l.attributes[e].includes(t)||l.attributes[e].push(t))})};B(()=>{V()}),F(()=>n.product,i=>{var e,t,o,b,f;l.brand_id=i.brand_id??null,l.category_id=i.category_id??null,l.sku=i.sku??"",l.price=i.price??0,l.currency=i.currency??"MDL",l.is_active=!!i.is_active,l.sort_order=i.sort_order??0;for(const d of["ru","ro","en"]){const a=(e=i.translations)==null?void 0:e.find(g=>g.language===d);l.translations[d].name=(a==null?void 0:a.name)??"",l.translations[d].slug=(a==null?void 0:a.slug)??"",l.translations[d].short_description=(a==null?void 0:a.short_description)??"",l.translations[d].full_description=(a==null?void 0:a.full_description)??""}l.main_image_id=((o=(t=i.images)==null?void 0:t.find(d=>d.is_main))==null?void 0:o.id)??null,l.small_image_id=((f=(b=i.images)==null?void 0:b.find(d=>d.small_path))==null?void 0:f.id)??null,l.attributes={},V()},{immediate:!1});const E=i=>{l.images=Array.from(i.target.files||[])};l.transform(i=>{const e={};n.attributes.forEach(d=>{e[d.id]=new Set((d.values||[]).map(a=>Number(a.id)))});const t={};Object.keys(e).forEach(d=>{var I;const a=Number(d),g=(I=i.attributes)==null?void 0:I[a],D=Array.isArray(g)?g:g!=null?[g]:[];t[a]=D.map(k=>Number(k)).filter(k=>Number.isInteger(k)&&e[a].has(k))});const o=Array.isArray(i.delete_image_ids)?i.delete_image_ids.map(d=>Number(d)).filter(Number.isInteger):[],b=i.main_image_id!=null&&i.main_image_id!==""?Number(i.main_image_id):null,f=i.small_image_id!=null&&i.small_image_id!==""?Number(i.small_image_id):null;return{...i,_method:"put",attributes:t,delete_image_ids:o,main_image_id:b,small_image_id:f}});const C=()=>{n.attributes.forEach(i=>{Array.isArray(l.attributes[i.id])||(l.attributes[i.id]=[])}),l.post(route("admin.products.update",n.product.id),{forceFormData:!0,preserveScroll:!0})};return(i,e)=>(m(),u("div",R,[e[33]||(e[33]=s("h1",{class:"text-xl font-semibold"},"Редактировать товар",-1)),s("form",{onSubmit:P(C,["prevent"]),class:"space-y-8"},[s("div",G,[e[19]||(e[19]=s("h2",{class:"text-lg font-semibold"},"Основные данные",-1)),s("div",H,[s("div",null,[e[11]||(e[11]=s("label",{class:"block font-semibold mb-1"},"Бренд",-1)),p(s("select",{"onUpdate:modelValue":e[0]||(e[0]=t=>r(l).brand_id=t),class:"w-full rounded border px-2 py-1 bg-white"},[e[10]||(e[10]=s("option",{value:null},"— не выбран —",-1)),(m(!0),u(y,null,x(n.brands,t=>{var o;return m(),u("option",{key:t.id,value:t.id},v(((o=t.translation)==null?void 0:o.name)??`#${t.id}`),9,J)}),128))],512),[[M,r(l).brand_id]])]),s("div",null,[e[13]||(e[13]=s("label",{class:"block font-semibold mb-1"},"Категория",-1)),p(s("select",{"onUpdate:modelValue":e[1]||(e[1]=t=>r(l).category_id=t),class:"w-full rounded border px-2 py-1 bg-white"},[e[12]||(e[12]=s("option",{value:null},"— не выбрана —",-1)),(m(!0),u(y,null,x(n.categories,t=>{var o;return m(),u("option",{key:t.id,value:t.id},v(((o=t.translation)==null?void 0:o.name)??`#${t.id}`),9,Q)}),128))],512),[[M,r(l).category_id]])]),s("div",null,[e[14]||(e[14]=s("label",{class:"block font-semibold mb-1"},"SKU",-1)),p(s("input",{"onUpdate:modelValue":e[2]||(e[2]=t=>r(l).sku=t),class:"w-full rounded border px-2 py-1"},null,512),[[_,r(l).sku]])]),s("div",null,[e[15]||(e[15]=s("label",{class:"block font-semibold mb-1"},"Цена",-1)),p(s("input",{type:"number",step:"0.01","onUpdate:modelValue":e[3]||(e[3]=t=>r(l).price=t),class:"w-full rounded border px-2 py-1"},null,512),[[_,r(l).price,void 0,{number:!0}]])]),s("div",null,[e[16]||(e[16]=s("label",{class:"block font-semibold mb-1"},"Валюта",-1)),p(s("input",{"onUpdate:modelValue":e[4]||(e[4]=t=>r(l).currency=t),class:"w-full rounded border px-2 py-1"},null,512),[[_,r(l).currency]])]),s("div",W,[p(s("input",{id:"is_active",type:"checkbox","onUpdate:modelValue":e[5]||(e[5]=t=>r(l).is_active=t)},null,512),[[w,r(l).is_active]]),e[17]||(e[17]=s("label",{for:"is_active",class:"font-semibold"},"Активен",-1))]),s("div",null,[e[18]||(e[18]=s("label",{class:"block font-semibold mb-1"},"Порядок",-1)),p(s("input",{type:"number",min:"0","onUpdate:modelValue":e[6]||(e[6]=t=>r(l).sort_order=t),class:"w-full rounded border px-2 py-1"},null,512),[[_,r(l).sort_order,void 0,{number:!0}]])])])]),s("div",X,[e[24]||(e[24]=s("h2",{class:"text-lg font-semibold"},"Переводы",-1)),s("div",Y,[(m(),u(y,null,x(["ru","ro","en"],t=>s("div",{key:t,class:"space-y-2"},[s("h3",Z,v(t),1),s("div",null,[e[20]||(e[20]=s("label",{class:"block"},"Название",-1)),p(s("input",{"onUpdate:modelValue":o=>r(l).translations[t].name=o,class:"w-full rounded border px-2 py-1"},null,8,ee),[[_,r(l).translations[t].name]])]),s("div",null,[e[21]||(e[21]=s("label",{class:"block"},"Slug",-1)),p(s("input",{"onUpdate:modelValue":o=>r(l).translations[t].slug=o,class:"w-full rounded border px-2 py-1"},null,8,se),[[_,r(l).translations[t].slug]])]),s("div",null,[e[22]||(e[22]=s("label",{class:"block"},"Кратко",-1)),p(s("textarea",{"onUpdate:modelValue":o=>r(l).translations[t].short_description=o,class:"w-full rounded border px-2 py-1",rows:"3"},null,8,te),[[_,r(l).translations[t].short_description]])]),s("div",null,[e[23]||(e[23]=s("label",{class:"block"},"Полное описание",-1)),p(s("textarea",{"onUpdate:modelValue":o=>r(l).translations[t].full_description=o,class:"w-full rounded border px-2 py-1",rows:"5"},null,8,le),[[_,r(l).translations[t].full_description]])])])),64))])]),s("div",ie,[e[29]||(e[29]=s("h2",{class:"text-lg font-semibold"},"Галерея",-1)),s("div",oe,[(m(!0),u(y,null,x(n.product.images||[],t=>(m(),u("div",{key:t.id,class:L(["p-2 rounded border space-y-2 bg-white/70",[r(l).main_image_id===t.id?"border-green-500 ring-2 ring-green-400":"",r(l).small_image_id===t.id?"border-blue-500 ring-2 ring-blue-400":""]])},[s("img",{src:`/storage/${t.path}`,class:"w-full h-24 object-cover rounded border"},null,8,re),s("div",ne,[t.size_kb!=null?(m(),u("span",de,v(t.size_kb)+" KB",1)):(m(),u("span",ae,"—")),t.small_path?(m(),u("span",ue,"SMALL")):t.is_main?(m(),u("span",me,"MAIN")):j("",!0)]),s("div",pe,[s("label",be,[p(s("input",{type:"checkbox",value:t.id,"onUpdate:modelValue":e[7]||(e[7]=o=>r(l).delete_image_ids=o)},null,8,ce),[[w,r(l).delete_image_ids]]),e[25]||(e[25]=s("span",null,"Удалить",-1))]),s("label",_e,[p(s("input",{type:"radio",name:"main_image",value:t.id,"onUpdate:modelValue":e[8]||(e[8]=o=>r(l).main_image_id=o)},null,8,fe),[[S,r(l).main_image_id]]),e[26]||(e[26]=s("span",{class:"text-green-700 font-semibold"},"Главное",-1))]),s("label",ge,[p(s("input",{type:"radio",name:"small_image",value:t.id,"onUpdate:modelValue":e[9]||(e[9]=o=>r(l).small_image_id=o)},null,8,ye),[[S,r(l).small_image_id]]),e[27]||(e[27]=s("span",{class:"text-blue-700 font-semibold"},"Для сетки (small)",-1))])])],2))),128))]),s("div",null,[e[28]||(e[28]=s("label",{class:"block font-semibold mb-1"},"Добавить изображения",-1)),s("input",{type:"file",multiple:"",onChange:E},null,32)])]),s("div",xe,[e[30]||(e[30]=s("h2",{class:"text-lg font-semibold"},"Атрибуты",-1)),(m(!0),u(y,null,x(n.attributes,t=>{var o;return m(),u("div",{key:t.id,class:"rounded border p-4 bg-white/50"},[s("label",ve,v(((o=t.translation)==null?void 0:o.name)??`#${t.id}`),1),s("div",ke,[(m(!0),u(y,null,x(t.values||[],b=>{var f;return m(),u("label",{key:b.id,class:"flex items-center gap-2 text-sm px-2 py-1 rounded hover:bg-admin-muted/10 transition",for:`attr-${t.id}-val-${b.id}`},[p(s("input",{class:"rounded",type:"checkbox",id:`attr-${t.id}-val-${b.id}`,value:b.id,"onUpdate:modelValue":d=>r(l).attributes[t.id]=d},null,8,Ve),[[w,r(l).attributes[t.id]]]),s("span",null,v(((f=b.translation)==null?void 0:f.value)??`#${b.id}`),1)],8,we)}),128))])])}),128))]),s("div",Ue,[e[32]||(e[32]=s("button",{class:"bg-admin-primary text-white px-4 py-2 rounded-lg hover:bg-admin-muted transition"},"Обновить",-1)),T(r(q),{href:i.route("admin.products.index"),class:"px-4 py-2 border rounded-lg hover:bg-white transition"},{default:K(()=>e[31]||(e[31]=[O(" Отмена ",-1)])),_:1,__:[31]},8,["href"])])],32)]))}};export{Ae as default};
