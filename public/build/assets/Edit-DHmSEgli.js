import{u as F,B,i as j,c as b,o as c,a as s,f as u,k as M,e as r,F as y,r as v,t as x,v as _,m as w,z,C as $,b as L,w as T,d as O,l as q,h as K}from"./app-Bv7qXi90.js";const P={class:"max-w-7xl mx-auto py-6 space-y-8 text-admin-text"},R={class:"space-y-4"},G={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},H=["value"],J=["value"],Q={class:"flex items-center gap-2"},W={class:"space-y-4"},X={class:"grid grid-cols-1 md:grid-cols-3 gap-6"},Y={class:"font-semibold uppercase"},Z=["onUpdate:modelValue"],ee=["onUpdate:modelValue"],se=["onUpdate:modelValue"],te=["onUpdate:modelValue"],le={class:"space-y-4"},ie={class:"grid grid-cols-2 md:grid-cols-6 gap-4"},oe=["src"],re={class:"mt-2 flex flex-col gap-1 text-xs"},ne={class:"inline-flex items-center gap-1"},de=["value"],ae={class:"inline-flex items-center gap-1"},ue=["value"],me={class:"inline-flex items-center gap-1"},pe=["value"],be={class:"space-y-4"},ce={class:"block font-semibold mb-2"},_e={class:"flex flex-wrap gap-3"},ge=["for"],fe=["id","value","onUpdate:modelValue"],ye={class:"flex gap-2"},xe={__name:"Edit",props:{product:{type:Object,required:!0},brands:{type:Array,default:()=>[]},categories:{type:Array,default:()=>[]},attributes:{type:Array,default:()=>[]}},setup(S){var U,A,N,h;const n=S,p=(i,e)=>{var t,o;return((o=(t=n.product.translations)==null?void 0:t.find(m=>m.language===i))==null?void 0:o[e])??""},l=F({brand_id:n.product.brand_id??null,category_id:n.product.category_id??null,sku:n.product.sku??"",price:n.product.price??0,currency:n.product.currency??"MDL",is_active:!!n.product.is_active,sort_order:n.product.sort_order??0,translations:{ru:{name:p("ru","name"),slug:p("ru","slug"),short_description:p("ru","short_description"),full_description:p("ru","full_description")},ro:{name:p("ro","name"),slug:p("ro","slug"),short_description:p("ro","short_description"),full_description:p("ro","full_description")},en:{name:p("en","name"),slug:p("en","slug"),short_description:p("en","short_description"),full_description:p("en","full_description")}},images:[],delete_image_ids:[],main_image_id:((A=(U=n.product.images)==null?void 0:U.find(i=>i.is_main))==null?void 0:A.id)??null,small_image_id:((h=(N=n.product.images)==null?void 0:N.find(i=>i.small_path))==null?void 0:h.id)??null,attributes:{}}),V=()=>{n.attributes.forEach(i=>{Array.isArray(l.attributes[i.id])||(l.attributes[i.id]=[])}),(n.product.attribute_values||[]).forEach(i=>{var o;const e=(o=i==null?void 0:i.pivot)==null?void 0:o.attribute_id,t=i==null?void 0:i.id;!e||!Number.isInteger(Number(e))||!Number.isInteger(Number(t))||(Array.isArray(l.attributes[e])||(l.attributes[e]=[]),l.attributes[e].includes(t)||l.attributes[e].push(t))})};B(()=>{V()}),j(()=>n.product,i=>{var e,t,o,m,g;l.brand_id=i.brand_id??null,l.category_id=i.category_id??null,l.sku=i.sku??"",l.price=i.price??0,l.currency=i.currency??"MDL",l.is_active=!!i.is_active,l.sort_order=i.sort_order??0;for(const d of["ru","ro","en"]){const a=(e=i.translations)==null?void 0:e.find(f=>f.language===d);l.translations[d].name=(a==null?void 0:a.name)??"",l.translations[d].slug=(a==null?void 0:a.slug)??"",l.translations[d].short_description=(a==null?void 0:a.short_description)??"",l.translations[d].full_description=(a==null?void 0:a.full_description)??""}l.main_image_id=((o=(t=i.images)==null?void 0:t.find(d=>d.is_main))==null?void 0:o.id)??null,l.small_image_id=((g=(m=i.images)==null?void 0:m.find(d=>d.small_path))==null?void 0:g.id)??null,l.attributes={},V()},{immediate:!1});const E=i=>{l.images=Array.from(i.target.files||[])};l.transform(i=>{const e={};n.attributes.forEach(d=>{e[d.id]=new Set((d.values||[]).map(a=>Number(a.id)))});const t={};Object.keys(e).forEach(d=>{var I;const a=Number(d),f=(I=i.attributes)==null?void 0:I[a],C=Array.isArray(f)?f:f!=null?[f]:[];t[a]=C.map(k=>Number(k)).filter(k=>Number.isInteger(k)&&e[a].has(k))});const o=Array.isArray(i.delete_image_ids)?i.delete_image_ids.map(d=>Number(d)).filter(Number.isInteger):[],m=i.main_image_id!=null&&i.main_image_id!==""?Number(i.main_image_id):null,g=i.small_image_id!=null&&i.small_image_id!==""?Number(i.small_image_id):null;return{...i,_method:"put",attributes:t,delete_image_ids:o,main_image_id:m,small_image_id:g}});const D=()=>{n.attributes.forEach(i=>{Array.isArray(l.attributes[i.id])||(l.attributes[i.id]=[])}),l.post(route("admin.products.update",n.product.id),{forceFormData:!0,preserveScroll:!0})};return(i,e)=>(c(),b("div",P,[e[33]||(e[33]=s("h1",{class:"text-xl font-semibold"},"Редактировать товар",-1)),s("form",{onSubmit:K(D,["prevent"]),class:"space-y-8"},[s("div",R,[e[19]||(e[19]=s("h2",{class:"text-lg font-semibold"},"Основные данные",-1)),s("div",G,[s("div",null,[e[11]||(e[11]=s("label",{class:"block font-semibold mb-1"},"Бренд",-1)),u(s("select",{"onUpdate:modelValue":e[0]||(e[0]=t=>r(l).brand_id=t),class:"w-full rounded border px-2 py-1 bg-white"},[e[10]||(e[10]=s("option",{value:null},"— не выбран —",-1)),(c(!0),b(y,null,v(n.brands,t=>{var o;return c(),b("option",{key:t.id,value:t.id},x(((o=t.translation)==null?void 0:o.name)??`#${t.id}`),9,H)}),128))],512),[[M,r(l).brand_id]])]),s("div",null,[e[13]||(e[13]=s("label",{class:"block font-semibold mb-1"},"Категория",-1)),u(s("select",{"onUpdate:modelValue":e[1]||(e[1]=t=>r(l).category_id=t),class:"w-full rounded border px-2 py-1 bg-white"},[e[12]||(e[12]=s("option",{value:null},"— не выбрана —",-1)),(c(!0),b(y,null,v(n.categories,t=>{var o;return c(),b("option",{key:t.id,value:t.id},x(((o=t.translation)==null?void 0:o.name)??`#${t.id}`),9,J)}),128))],512),[[M,r(l).category_id]])]),s("div",null,[e[14]||(e[14]=s("label",{class:"block font-semibold mb-1"},"SKU",-1)),u(s("input",{"onUpdate:modelValue":e[2]||(e[2]=t=>r(l).sku=t),class:"w-full rounded border px-2 py-1"},null,512),[[_,r(l).sku]])]),s("div",null,[e[15]||(e[15]=s("label",{class:"block font-semibold mb-1"},"Цена",-1)),u(s("input",{type:"number",step:"0.01","onUpdate:modelValue":e[3]||(e[3]=t=>r(l).price=t),class:"w-full rounded border px-2 py-1"},null,512),[[_,r(l).price,void 0,{number:!0}]])]),s("div",null,[e[16]||(e[16]=s("label",{class:"block font-semibold mb-1"},"Валюта",-1)),u(s("input",{"onUpdate:modelValue":e[4]||(e[4]=t=>r(l).currency=t),class:"w-full rounded border px-2 py-1"},null,512),[[_,r(l).currency]])]),s("div",Q,[u(s("input",{id:"is_active",type:"checkbox","onUpdate:modelValue":e[5]||(e[5]=t=>r(l).is_active=t)},null,512),[[w,r(l).is_active]]),e[17]||(e[17]=s("label",{for:"is_active",class:"font-semibold"},"Активен",-1))]),s("div",null,[e[18]||(e[18]=s("label",{class:"block font-semibold mb-1"},"Порядок",-1)),u(s("input",{type:"number",min:"0","onUpdate:modelValue":e[6]||(e[6]=t=>r(l).sort_order=t),class:"w-full rounded border px-2 py-1"},null,512),[[_,r(l).sort_order,void 0,{number:!0}]])])])]),s("div",W,[e[24]||(e[24]=s("h2",{class:"text-lg font-semibold"},"Переводы",-1)),s("div",X,[(c(),b(y,null,v(["ru","ro","en"],t=>s("div",{key:t,class:"space-y-2"},[s("h3",Y,x(t),1),s("div",null,[e[20]||(e[20]=s("label",{class:"block"},"Название",-1)),u(s("input",{"onUpdate:modelValue":o=>r(l).translations[t].name=o,class:"w-full rounded border px-2 py-1"},null,8,Z),[[_,r(l).translations[t].name]])]),s("div",null,[e[21]||(e[21]=s("label",{class:"block"},"Slug",-1)),u(s("input",{"onUpdate:modelValue":o=>r(l).translations[t].slug=o,class:"w-full rounded border px-2 py-1"},null,8,ee),[[_,r(l).translations[t].slug]])]),s("div",null,[e[22]||(e[22]=s("label",{class:"block"},"Кратко",-1)),u(s("textarea",{"onUpdate:modelValue":o=>r(l).translations[t].short_description=o,class:"w-full rounded border px-2 py-1",rows:"3"},null,8,se),[[_,r(l).translations[t].short_description]])]),s("div",null,[e[23]||(e[23]=s("label",{class:"block"},"Полное описание",-1)),u(s("textarea",{"onUpdate:modelValue":o=>r(l).translations[t].full_description=o,class:"w-full rounded border px-2 py-1",rows:"5"},null,8,te),[[_,r(l).translations[t].full_description]])])])),64))])]),s("div",le,[e[29]||(e[29]=s("h2",{class:"text-lg font-semibold"},"Галерея",-1)),s("div",ie,[(c(!0),b(y,null,v(n.product.images||[],t=>(c(),b("div",{key:t.id,class:z(["p-2 rounded border space-y-2 bg-white/70",[r(l).main_image_id===t.id?"border-green-500 ring-2 ring-green-400":"",r(l).small_image_id===t.id?"border-blue-500 ring-2 ring-blue-400":""]])},[s("img",{src:`/storage/${t.path}`,class:"w-full h-24 object-cover rounded border"},null,8,oe),s("div",re,[s("label",ne,[u(s("input",{type:"checkbox",value:t.id,"onUpdate:modelValue":e[7]||(e[7]=o=>r(l).delete_image_ids=o)},null,8,de),[[w,r(l).delete_image_ids]]),e[25]||(e[25]=s("span",null,"Удалить",-1))]),s("label",ae,[u(s("input",{type:"radio",name:"main_image",value:t.id,"onUpdate:modelValue":e[8]||(e[8]=o=>r(l).main_image_id=o)},null,8,ue),[[$,r(l).main_image_id]]),e[26]||(e[26]=s("span",{class:"text-green-700 font-semibold"},"Главное",-1))]),s("label",me,[u(s("input",{type:"radio",name:"small_image",value:t.id,"onUpdate:modelValue":e[9]||(e[9]=o=>r(l).small_image_id=o)},null,8,pe),[[$,r(l).small_image_id]]),e[27]||(e[27]=s("span",{class:"text-blue-700 font-semibold"},"Для сетки (small)",-1))])])],2))),128))]),s("div",null,[e[28]||(e[28]=s("label",{class:"block font-semibold mb-1"},"Добавить изображения",-1)),s("input",{type:"file",multiple:"",onChange:E},null,32)])]),s("div",be,[e[30]||(e[30]=s("h2",{class:"text-lg font-semibold"},"Атрибуты",-1)),(c(!0),b(y,null,v(n.attributes,t=>{var o;return c(),b("div",{key:t.id,class:"rounded border p-4 bg-white/50"},[s("label",ce,x(((o=t.translation)==null?void 0:o.name)??`#${t.id}`),1),s("div",_e,[(c(!0),b(y,null,v(t.values||[],m=>{var g;return c(),b("label",{key:m.id,class:"flex items-center gap-2 text-sm px-2 py-1 rounded hover:bg-admin-muted/10 transition",for:`attr-${t.id}-val-${m.id}`},[u(s("input",{class:"rounded",type:"checkbox",id:`attr-${t.id}-val-${m.id}`,value:m.id,"onUpdate:modelValue":d=>r(l).attributes[t.id]=d},null,8,fe),[[w,r(l).attributes[t.id]]]),s("span",null,x(((g=m.translation)==null?void 0:g.value)??`#${m.id}`),1)],8,ge)}),128))])])}),128))]),s("div",ye,[e[32]||(e[32]=s("button",{class:"bg-admin-primary text-white px-4 py-2 rounded-lg hover:bg-admin-muted transition"},"Обновить",-1)),L(r(q),{href:i.route("admin.products.index"),class:"px-4 py-2 border rounded-lg hover:bg-white transition"},{default:T(()=>e[31]||(e[31]=[O(" Отмена ",-1)])),_:1,__:[31]},8,["href"])])],32)]))}};export{xe as default};
