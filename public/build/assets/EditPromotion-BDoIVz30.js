import{u as F,x as U,p as c,i as g,c as n,o as u,a as e,b as q,w as C,d as S,e as i,l as N,g as y,f as a,v,k as _,F as P,r as D,t as p,m as G,h as z}from"./app-CUyQVF3J.js";const A={class:"p-6 max-w-4xl mx-auto space-y-6"},E={class:"flex justify-between items-center"},I={class:"space-y-2"},T=["value"],O={key:0,class:"text-red-600 text-xs mt-1"},$={key:0},H={key:0,class:"text-red-600 text-xs mt-1"},J={key:1,class:"space-y-4"},K={class:"space-y-2"},Q=["value"],R={key:0,class:"text-red-600 text-xs mt-1"},W={key:0,class:"text-red-600 text-xs mt-1"},X={class:"grid grid-cols-1 sm:grid-cols-3 gap-4"},Y={class:"flex justify-end space-x-3"},Z=["disabled"],tt={__name:"EditPromotion",props:{promotion:Object,products:Array,types:Array},setup(w){var k,V;const d=w,s=F({product_id:d.promotion.product_id??"",type:d.promotion.type,title:d.promotion.title??"",discount_price:d.promotion.discount_price??"",gift_product_id:d.promotion.gift_product_id??"",gift_quantity:d.promotion.gift_quantity??1,is_active:!!d.promotion.is_active,starts_at:d.promotion.starts_at??"",ends_at:d.promotion.ends_at??"",priority:d.promotion.priority??100}),m=U(""),b=c(()=>d.products.find(l=>l.id===Number(s.product_id))),L=c(()=>{if(!m.value)return d.products;const l=m.value.toLowerCase();return d.products.filter(t=>{var o,r;return((r=(o=t.translation)==null?void 0:o.name)==null?void 0:r.toLowerCase().includes(l))||String(t.id).includes(l)})});b.value&&(m.value=((k=b.value.translation)==null?void 0:k.name)||""),g(()=>s.product_id,()=>{var l;b.value&&(m.value=((l=b.value.translation)==null?void 0:l.name)||"")}),g(()=>m.value,l=>{var t;b.value&&l!==((t=b.value.translation)==null?void 0:t.name)&&(s.product_id="")});const f=U(""),x=c(()=>d.products.find(l=>l.id===Number(s.gift_product_id))),M=c(()=>{if(!f.value)return d.products;const l=f.value.toLowerCase();return d.products.filter(t=>{var o,r;return((r=(o=t.translation)==null?void 0:o.name)==null?void 0:r.toLowerCase().includes(l))||String(t.id).includes(l)})});x.value&&(f.value=((V=x.value.translation)==null?void 0:V.name)||""),g(()=>s.gift_product_id,()=>{var l;x.value&&(f.value=((l=x.value.translation)==null?void 0:l.name)||"")}),g(()=>f.value,l=>{var t;x.value&&l!==((t=x.value.translation)==null?void 0:t.name)&&(s.gift_product_id="")});const j=c(()=>s.type==="discount"),B=c(()=>s.type==="gift");return(l,t)=>(u(),n("div",A,[e("div",E,[t[13]||(t[13]=e("h1",{class:"text-xl font-semibold text-admin-text"},"Редактирование акции",-1)),q(i(N),{href:l.route("admin.promotions.index"),class:"text-sm text-admin-muted hover:underline"},{default:C(()=>t[12]||(t[12]=[S("← Назад",-1)])),_:1,__:[12]},8,["href"])]),e("form",{onSubmit:t[11]||(t[11]=z(o=>i(s).put(l.route("admin.promotions.update",w.promotion.id)),["prevent"])),class:"bg-white border border-gray-300 rounded-lg p-6 space-y-6"},[e("div",null,[t[14]||(t[14]=e("label",{class:"block text-sm font-medium mb-1"},"Товар",-1)),e("div",I,[a(e("input",{"onUpdate:modelValue":t[0]||(t[0]=o=>m.value=o),type:"text",placeholder:"Поиск товара...",class:"w-full border rounded px-3 py-2 text-sm"},null,512),[[v,m.value]]),a(e("select",{"onUpdate:modelValue":t[1]||(t[1]=o=>i(s).product_id=o),size:"6",class:"w-full border rounded px-3 py-2"},[(u(!0),n(P,null,D(L.value,o=>{var r;return u(),n("option",{key:o.id,value:o.id},p(((r=o.translation)==null?void 0:r.name)||"—")+" (ID "+p(o.id)+") ",9,T)}),128))],512),[[_,i(s).product_id]])]),i(s).errors.product_id?(u(),n("div",O,p(i(s).errors.product_id),1)):y("",!0)]),e("div",null,[t[16]||(t[16]=e("label",{class:"block text-sm font-medium mb-1"},"Тип акции",-1)),a(e("select",{"onUpdate:modelValue":t[2]||(t[2]=o=>i(s).type=o),disabled:"",class:"w-full border rounded px-3 py-2 bg-gray-100 cursor-not-allowed"},t[15]||(t[15]=[e("option",{value:"discount"},"Скидка",-1),e("option",{value:"gift"},"Подарок",-1)]),512),[[_,i(s).type]]),t[17]||(t[17]=e("p",{class:"text-xs text-gray-500 mt-1"},"Тип акции нельзя изменить после создания",-1))]),e("div",null,[t[18]||(t[18]=e("label",{class:"block text-sm font-medium mb-1"},"Название (опционально)",-1)),a(e("input",{"onUpdate:modelValue":t[3]||(t[3]=o=>i(s).title=o),type:"text",class:"w-full border rounded px-3 py-2"},null,512),[[v,i(s).title]])]),j.value?(u(),n("div",$,[t[19]||(t[19]=e("label",{class:"block text-sm font-medium mb-1"},"Цена по акции",-1)),a(e("input",{"onUpdate:modelValue":t[4]||(t[4]=o=>i(s).discount_price=o),type:"number",step:"0.01",class:"w-full border rounded px-3 py-2"},null,512),[[v,i(s).discount_price]]),i(s).errors.discount_price?(u(),n("div",H,p(i(s).errors.discount_price),1)):y("",!0)])):y("",!0),B.value?(u(),n("div",J,[e("div",null,[t[20]||(t[20]=e("label",{class:"block text-sm font-medium mb-1"},"Товар-подарок",-1)),e("div",K,[a(e("input",{"onUpdate:modelValue":t[5]||(t[5]=o=>f.value=o),type:"text",placeholder:"Поиск подарка...",class:"w-full border rounded px-3 py-2 text-sm"},null,512),[[v,f.value]]),a(e("select",{"onUpdate:modelValue":t[6]||(t[6]=o=>i(s).gift_product_id=o),size:"6",class:"w-full border rounded px-3 py-2"},[(u(!0),n(P,null,D(M.value,o=>{var r;return u(),n("option",{key:o.id,value:o.id},p(((r=o.translation)==null?void 0:r.name)||"—")+" (ID "+p(o.id)+") ",9,Q)}),128))],512),[[_,i(s).gift_product_id]])]),i(s).errors.gift_product_id?(u(),n("div",R,p(i(s).errors.gift_product_id),1)):y("",!0)]),e("div",null,[t[21]||(t[21]=e("label",{class:"block text-sm font-medium mb-1"},"Количество",-1)),a(e("input",{"onUpdate:modelValue":t[7]||(t[7]=o=>i(s).gift_quantity=o),type:"number",min:"1",class:"w-full border rounded px-3 py-2"},null,512),[[v,i(s).gift_quantity]]),i(s).errors.gift_quantity?(u(),n("div",W,p(i(s).errors.gift_quantity),1)):y("",!0)])])):y("",!0),e("div",X,[e("div",null,[t[22]||(t[22]=e("label",{class:"block text-sm font-medium mb-1"},"Активна",-1)),a(e("input",{type:"checkbox","onUpdate:modelValue":t[8]||(t[8]=o=>i(s).is_active=o)},null,512),[[G,i(s).is_active]])]),e("div",null,[t[23]||(t[23]=e("label",{class:"block text-sm font-medium mb-1"},"Дата начала",-1)),a(e("input",{type:"date","onUpdate:modelValue":t[9]||(t[9]=o=>i(s).starts_at=o),class:"w-full border rounded px-3 py-2"},null,512),[[v,i(s).starts_at]])]),e("div",null,[t[24]||(t[24]=e("label",{class:"block text-sm font-medium mb-1"},"Дата окончания",-1)),a(e("input",{type:"date","onUpdate:modelValue":t[10]||(t[10]=o=>i(s).ends_at=o),class:"w-full border rounded px-3 py-2"},null,512),[[v,i(s).ends_at]])])]),e("div",Y,[q(i(N),{href:l.route("admin.promotions.index"),class:"px-4 py-2 border rounded-lg hover:bg-gray-100 transition"},{default:C(()=>t[25]||(t[25]=[S(" Отмена ",-1)])),_:1,__:[25]},8,["href"]),e("button",{type:"submit",disabled:i(s).processing,class:"bg-admin-primary text-white px-6 py-2 rounded-lg hover:bg-admin-muted transition"}," Сохранить ",8,Z)])],32)]))}};export{tt as default};
